{"name":"Ajaxfile","tagline":"","body":"jQuery.extend({\r\n\thandleError: function( s, xhr, status, e )      {  \r\n            // If a local callback was specified, fire it  \r\n                    if ( s.error ) {  \r\n                        s.error.call( s.context || s, xhr, status, e );  \r\n                    }  \r\n      \r\n                    // Fire the global callback  \r\n                    if ( s.global ) {  \r\n                        (s.context ? jQuery(s.context) : jQuery.event).trigger( \"ajaxError\", [xhr, s, e] );  \r\n                    }  \r\n        }, \r\n\t\r\n\tcreateUploadIframe: function(id, uri)\r\n\t{\r\n\t//create frame\r\n\tvar frameId = 'jUploadFrame' + id;\r\n\tvar iframeHtml = '<iframe id=\"' + frameId + '\" name=\"' + frameId + '\" style=\"position:absolute; top:-9999px; left:-9999px\"';\r\n\tif(window.ActiveXObject)\r\n\t{\r\n\tif(typeof uri== 'boolean'){\r\n\tiframeHtml += ' src=\"' + 'javascript:false' + '\"';\r\n\t\r\n\t}\r\n\telse if(typeof uri== 'string'){\r\n\tiframeHtml += ' src=\"' + uri + '\"';\r\n\t\r\n\t}\r\n\t}\r\n\tiframeHtml += ' />';\r\n\tjQuery(iframeHtml).appendTo(document.body);\r\n\t\r\n\treturn jQuery('#' + frameId).get(0);\r\n\t},\r\n\tcreateUploadForm: function(id, fileElementId, data)\r\n\t{\r\n\t//create form\r\n\tvar formId = 'jUploadForm' + id;\r\n\tvar fileId = 'jUploadFile' + id;\r\n\tvar form = jQuery('<form action=\"\" method=\"POST\" name=\"' + formId + '\" id=\"' + formId + '\" enctype=\"multipart/form-data\"></form>');\r\n\tif(data)\r\n\t{\r\n\tfor(var i in data)\r\n\t{\r\n\tjQuery('<input type=\"hidden\" name=\"' + i + '\" value=\"' + data[i] + '\" />').appendTo(form);\r\n\t}\r\n\t}\r\n\tvar oldElement = jQuery('#' + fileElementId);\r\n\tvar newElement = jQuery(oldElement).clone();\r\n\tjQuery(oldElement).attr('id', fileId);\r\n\tjQuery(oldElement).before(newElement);\r\n\tjQuery(oldElement).appendTo(form);\r\n\t\r\n\t\r\n\t\r\n\t//set attributes\r\n\tjQuery(form).css('position', 'absolute');\r\n\tjQuery(form).css('top', '-1200px');\r\n\tjQuery(form).css('left', '-1200px');\r\n\tjQuery(form).appendTo('body');\r\n\treturn form;\r\n\t},\r\n\t\r\n\tajaxFileUpload: function(s) {\r\n\t// TODO introduce global settings, allowing the client to modify them for all requests, not only timeout\r\n\ts = jQuery.extend({}, jQuery.ajaxSettings, s);\r\n\tvar id = new Date().getTime()\r\n\tvar form = jQuery.createUploadForm(id, s.fileElementId, (typeof(s.data)=='undefined'?false:s.data));\r\n\tvar io = jQuery.createUploadIframe(id, s.secureuri);\r\n\tvar frameId = 'jUploadFrame' + id;\r\n\tvar formId = 'jUploadForm' + id;\r\n\t// Watch for a new set of requests\r\n\tif ( s.global && ! jQuery.active++ )\r\n\t{\r\n\tjQuery.event.trigger( \"ajaxStart\" );\r\n\t}\r\n\tvar requestDone = false;\r\n\t// Create the request object\r\n\tvar xml = {}\r\n\tif ( s.global )\r\n\tjQuery.event.trigger(\"ajaxSend\", [xml, s]);\r\n\t// Wait for a response to come back\r\n\tvar uploadCallback = function(isTimeout)\r\n\t{\r\n\tvar io = document.getElementById(frameId);\r\n\ttry\r\n\t{\r\n\tif(io.contentWindow)\r\n\t{\r\n\txml.responseText = io.contentWindow.document.body?io.contentWindow.document.body.innerHTML:null;\r\n\txml.responseXML = io.contentWindow.document.XMLDocument?io.contentWindow.document.XMLDocument:io.contentWindow.document;\r\n\t\r\n\t}else if(io.contentDocument)\r\n\t{\r\n\txml.responseText = io.contentDocument.document.body?io.contentDocument.document.body.innerHTML:null;\r\n\txml.responseXML = io.contentDocument.document.XMLDocument?io.contentDocument.document.XMLDocument:io.contentDocument.document;\r\n\t}\r\n\t}catch(e)\r\n\t{\r\n\tjQuery.handleError(s, xml, null, e);\r\n\t}\r\n\tif ( xml || isTimeout == \"timeout\")\r\n\t{\r\n\trequestDone = true;\r\n\tvar status;\r\n\ttry {\r\n\tstatus = isTimeout != \"timeout\" ? \"success\" : \"error\";\r\n\t// Make sure that the request was successful or notmodified\r\n\tif ( status != \"error\" )\r\n\t{\r\n\t// process the data (runs the xml through httpData regardless of callback)\r\n\tvar data = jQuery.uploadHttpData( xml, s.dataType );\r\n\t// If a local callback was specified, fire it and pass it the data\r\n\tif ( s.success )\r\n\ts.success( data, status );\r\n\t\r\n\t// Fire the global callback\r\n\tif( s.global )\r\n\tjQuery.event.trigger( \"ajaxSuccess\", [xml, s] );\r\n\t} else\r\n\tjQuery.handleError(s, xml, status);\r\n\t} catch(e)\r\n\t{\r\n\tstatus = \"error\";\r\n\tjQuery.handleError(s, xml, status, e);\r\n\t}\r\n\t\r\n\t// The request was completed\r\n\tif( s.global )\r\n\tjQuery.event.trigger( \"ajaxComplete\", [xml, s] );\r\n\t\r\n\t// Handle the global AJAX counter\r\n\tif ( s.global && ! --jQuery.active )\r\n\tjQuery.event.trigger( \"ajaxStop\" );\r\n\t\r\n\t// Process result\r\n\tif ( s.complete )\r\n\ts.complete(xml, status);\r\n\t\r\n\tjQuery(io).unbind()\r\n\t\r\n\tsetTimeout(function()\r\n\t{ try\r\n\t{\r\n\tjQuery(io).remove();\r\n\tjQuery(form).remove();\r\n\t\r\n\t} catch(e)\r\n\t{\r\n\tjQuery.handleError(s, xml, null, e);\r\n\t}\r\n\t\r\n\t}, 100)\r\n\t\r\n\txml = null\r\n\t\r\n\t}\r\n\t}\r\n\t// Timeout checker\r\n\tif ( s.timeout > 0 )\r\n\t{\r\n\tsetTimeout(function(){\r\n\t// Check to see if the request is still happening\r\n\tif( !requestDone ) uploadCallback( \"timeout\" );\r\n\t}, s.timeout);\r\n\t}\r\n\ttry\r\n\t{\r\n\t\r\n\tvar form = jQuery('#' + formId);\r\n\tjQuery(form).attr('action', s.url);\r\n\tjQuery(form).attr('method', 'POST');\r\n\tjQuery(form).attr('target', frameId);\r\n\tif(form.encoding)\r\n\t{\r\n\tjQuery(form).attr('encoding', 'multipart/form-data');\r\n\t}\r\n\telse\r\n\t{\r\n\tjQuery(form).attr('enctype', 'multipart/form-data');\r\n\t}\r\n\tjQuery(form).submit();\r\n\t\r\n\t} catch(e)\r\n\t{\r\n\tjQuery.handleError(s, xml, null, e);\r\n\t}\r\n\t\r\n\tjQuery('#' + frameId).load(uploadCallback );\r\n\treturn {abort: function () {}};\r\n\t\r\n\t},\r\n\t\r\n\tuploadHttpData: function( r, type ) {\r\n\tvar data = !type;\r\n\tdata = type == \"xml\" || data ? r.responseXML : r.responseText;\r\n\t// If the type is \"script\", eval it in global context\r\n\tif ( type == \"script\" )\r\n\tjQuery.globalEval( data );\r\n\t// Get the JavaScript object, if JSON is used.\r\n\tif ( type == \"json\" )\r\n\teval( \"data = \" + data );\r\n\t// evaluate scripts within html\r\n\tif ( type == \"html\" )\r\n\tjQuery(\"<div>\").html(data).evalScripts();\r\n\t\r\n\treturn data;\r\n\t}\r\n\t})","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}